<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Earthquake Monitor</title>

  <!-- Load Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    #map {
      height: 500px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Recent Earthquakes</h1>

  <!-- Map container -->
  <div id="map"></div>

  <!-- List of earthquakes -->
  <ul id="quakes"></ul>

  <!-- Load Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      fetch("/data.json")
        .then(response => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then(data => {
          const list = document.getElementById("quakes");
          list.innerHTML = ""; // Clear list if needed

          // Initialize the map
          const map = L.map('map').setView([37.7749, -122.4194], 3);

          // Add OpenStreetMap tiles
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(map);

          // Define colored icons
          const blueIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
          });

          const orangeIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
          });

          const redIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
          });

          data.forEach(quake => {
            const lat = quake.geometry.coordinates[1];
            const lon = quake.geometry.coordinates[0];
            const place = quake.properties.place;
            const magnitude = quake.properties.mag;

            // Add to the list
            const li = document.createElement("li");
            li.textContent = `${place} - M${magnitude}`;
            list.appendChild(li);

            // Choose marker color based on magnitude
            let icon = blueIcon;
            if (magnitude >= 5) {
              icon = redIcon;
            } else if (magnitude >= 3) {
              icon = orangeIcon;
            }

            // Add marker to map
            L.marker([lat, lon], { icon: icon })
              .addTo(map)
              .bindPopup(`<b>${place}</b><br>Magnitude: ${magnitude}`);
          });
        })
        .catch(error => {
          console.error("Failed to load earthquake data:", error);
        });
    });
  </script>
</body>
</html>
